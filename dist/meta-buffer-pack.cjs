"use strict";var e=require("buffer/index.js");const t=new TextEncoder,r=new TextDecoder,n=f;function f(t,r=0){let n;if(void 0===t||"string"!=typeof t||"number"!=typeof r)throw TypeError("invlaid init variablie type name. ");return(t=t.toUpperCase()).includes("8")?(n=e.Buffer.alloc(1),t.includes("I")?n.writeInt8(r):n.writeUint8(r)):t.includes("16")?(n=e.Buffer.alloc(2),t.includes("I")?t.includes("L")?n.writeInt16LE(r):n.writeInt16BE(r):t.includes("L")?n.writeUint16LE(r):n.writeUint16BE(r)):t.includes("32")?(n=e.Buffer.alloc(4),t.includes("I")?t.includes("L")?n.writeInt32LE(r):n.writeInt32BE(r):t.includes("L")?n.writeUint32LE(r):n.writeUint32BE(r)):t.includes("F")?(n=e.Buffer.alloc(4),t.includes("L")?n.writeFloatLE(r):n.writeFloatBE(r)):t.includes("N")?n=e.Buffer.from(String(r)):console.log(`invalid type: ${t} or initvalue: ${r}`),n}const i=u;function u(t,r,n){let i,u="B";if("number"==typeof r)"number"==typeof n?(i=e.Buffer.alloc(r),0!==n&&i.fill(n),u="B"):(i=e.Buffer.from(String(r)),u="N");else if("string"==typeof r&&"number"==typeof n)u=r.toUpperCase(),i=f(r,n);else if("string"==typeof r&&void 0===n)i=e.Buffer.from(r),u="S";else if(r instanceof Uint8Array&&void 0===n)i=r instanceof e.Buffer?r:e.Buffer.from(r);else if(r instanceof ArrayBuffer&&void 0===n)i=e.Buffer.from(r);else if(ArrayBuffer.isView(r))i=e.Buffer.from(r.buffer,r.byteOffset,r.byteLength);else if("object"==typeof r&&void 0===n)i=e.Buffer.from(JSON.stringify(r)),u="O";else{if("boolean"!=typeof r||void 0!==n)throw TypeError("invalid meta buffer type");{const t=r?1:0;i=e.Buffer.from([t]),u="!"}}return"string"==typeof t&&t.includes("#")&&(t=""),[t,u,i]}const o=a;function a(...e){let t=0;return e.map((e=>{const r=t++;return"number"==typeof e?i(r,"N",e):i(r,e)}))}function c(e){if((e=e.toUpperCase()).includes("8"))return e.includes("I")?"int8":"uint8";if(e.includes("16"))return e.includes("I")?e.includes("L")?"int16_le":"int16_be":e.includes("L")?"uint16_le":"uint16_be";if(e.includes("32"))return e.includes("I")?e.includes("L")?"int32_le":"int32_be":e.includes("L")?"uint32_le":"uint32_be";if(e.includes("F"))return e.includes("L")?"float_le":"float_be";if("B"===e)return"buffer";if("S"===e)return"string";if("N"===e)return"number";if("O"===e)return"object";if("!"===e)return"boolean";throw TypeError("invalid data type")}function s(e,t,n,f){try{const i=c(e);if("int8"==i)return t.readInt8(n);if("uint8"===i)return t.readUint8(n);if("int16_le"===i)return t.readInt16LE(n);if("int16_be"===i)return t.readInt16BE(n);if("uint16_le"===i)return t.readUint16LE(n);if("uint16_be"===i)return t.readUint16BE(n);if("int32_le"===i)return t.readInt32LE(n);if("int32_be"===i)return t.readInt32BE(n);if("uint32_le"===i)return t.readUint32LE(n);if("uint32_be"===i)return t.readUint32BE(n);if("float_le"===i)return t.readFloatLE(n);if("float_be"===i)return t.readFloatBE(n);if("buffer"===i)return t.subarray(n,n+f);if("string"===i){const e=t.subarray(n,n+f);return r.decode(e)}if("number"===i){const e=t.subarray(n,n+f);return Number(r.decode(e))}if("object"===i){const e=t.subarray(n,n+f);return JSON.parse(r.decode(e))}if("boolean"===i){return 1===t.readInt8(n)}return}catch(e){}}function l(...r){const f=function(e){let t=[];return e.filter((e=>{if(!Array.isArray(e[0]))return e;t=t.concat(e)})).concat(t)}(r);let i=0;const u=[];let o,a,c=0;if(f.forEach((e=>{const[t,r,n]=e;i+=n.byteLength,("number"==typeof t||t.length>0)&&u.push([t,r,c,n.byteLength]),c=i})),u.length>0){let e=JSON.stringify(u);o=t.encode(e),a=o.byteLength,i=i+a+2}const s=e.Buffer.alloc(i);if(c=0,f.forEach((e=>{const t=e[2];s.set(t,c),c+=t.byteLength})),u.length>0){s.set(o,c);const e=n("16",a);return s.set(e,c+a),s}return s}const y=b;function b(e,r=!1){if(void 0===e)throw TypeError("Invalid data type: Undefined");if("string"==typeof e)return t.encode(e);if("number"==typeof e)return Uint8Array.from([e]);if(e instanceof ArrayBuffer){if(r)return new Uint8Array(e);{const t=new Uint8Array(e),r=new Uint8Array(e.byteLength);return r.set(t),r}}if(ArrayBuffer.isView(e)){if(r)return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);{const t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),r=new Uint8Array(e.byteLength);return r.set(t),r}}return t.encode(JSON.stringify(e))}const d=B;function B(t,r=!1){const n=b(t,r);return r?e.Buffer.from(n.buffer,n.byteOffset,n.byteLength):e.Buffer.from(n)}const g=p;function p(...t){const r=t.map((e=>B(e)));return e.Buffer.concat(r)}const h=L;function L(...e){try{let t=0,r=0;const n=e.map((e=>b(e)));n.forEach((e=>{t+=e.byteLength}));const f=new Uint8Array(t);return n.forEach((e=>{f.set(e,r),r+=e.byteLength})),f}catch(e){console.log(e)}}function m(e){return 0===A(e)?e.byteLength:e.byteLength-A(e)-w}function E(e,t){try{const n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),f=n.byteLength-t-2,i=n.subarray(f,n.byteLength-2),u=r.decode(i),o=JSON.parse(u);if(!Array.isArray(o)||!Array.isArray(o[0]))return;let a=o[0];if(!a)return;if(a.length<3)return;const[c,s,l]=a;if("string"!=typeof s||"number"!=typeof l)return;return o}catch(e){}}const w=2;function U(t){if(t instanceof ArrayBuffer&&(t=e.Buffer.from(t)),t instanceof Uint8Array){if(t.byteLength<=w)return 0;return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint16(t.byteLength-w)}return 0}function A(t){if(t instanceof ArrayBuffer&&(t=e.Buffer.from(t)),t instanceof Uint8Array){const e=t.byteLength;if(e<=w)return 0;const r=U(t);if(0===r||r>e)return 0;return E(t,r)?r:0}return 0}function _(e){const t=m(e);return e.subarray(0,t)}function I(t,r=!1){t instanceof ArrayBuffer&&(t=e.Buffer.from(t));const n=U(t);if(0===n)return;let f=E(t,n);return f?r?(f.forEach((e=>{null==e[3]&&(e[1].includes("8")?e[3]=1:e[1].includes("16")?e[3]=2:e[1].includes("32")||e[1].includes("F")?e[3]=4:e[1].includes("!")&&(e[3]=1)),e[4]=c(e[1])})),f):f:void 0}var v=Object.freeze({__proto__:null,B8:d,B8pack:g,Buffer:e.Buffer,MB:i,MBA:o,NB:n,TAIL_LEN:w,U8:y,U8pack:h,equal:function(e,t){if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},getBuffer:_,getBufferSize:m,getMeta:I,getMetaDetail:function(e){return I(e,!0)},getMetaSize:A,hex:function(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")},meta:function(...e){return I(l(...e))},metaBuffer:u,metaBufferArguments:a,metaDetail:function(...e){return I(l(...e),!0)},numberBuffer:f,pack:l,parseBuffer:B,parseBufferThenConcat:p,parseMetaInfo:E,parseTypeName:c,parseUint8Array:b,parseUint8ThenConcat:L,rawPack:function(...e){return _(l(...e))},readTail:U,readTypedBuffer:s,unpack:function(t,r){const n=r||I(t);if(!n)return;const f=e.Buffer.from(t),i={};let u=0;if(n.forEach((e=>{const[t,r,n,o]=e;let a=s(r,f,n,o);null!=a&&(i[t]=a,o&&(u+=o))})),r&&f.byteLength!==u){let e=f.byteLength-u,t=s("b",f,u,e);if(null==t)return;i.$OTHERS=t}let o=0,a=[];for(;i[o];)a.push(i[o++]);return a.length>0&&(i.args=a,i.$=i.args),i}});module.exports=v;
